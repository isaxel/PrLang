Задача заключается в том, чтобы создать на языке C консольное приложение, которое будет работать как простой HTTP-сервер, который может обслуживать запросы на файлы из определённой директории. Кроме того, нужно использовать потоки (нитки), чтобы обрабатывать несколько соединений одновременно. Я разберу задание и помогу вам сформулировать его основные моменты, чтобы можно было перейти к реализации.

Основные требования задачи:

Аргументы командной строки:

Порт для прослушивания TCP-соединений.

Путь к директории, из которой будут отдаваться файлы.

TCP-сервер:

Программа должна слушать входящие TCP-соединения.

При подключении клиента (например, браузера) сервер должен принять HTTP-запрос и передать нужный файл.

Обработка HTTP-запросов:

Запрос должен содержать имя файла, который нужно отдать (через HTTP-заголовки).

Имя файла может быть относительным, и сервер должен правильно обрабатывать путь и искать файл в указанной директории.

Важно, чтобы сервер поддерживал передачу файлов любого размера, а также умел обрабатывать несколько запросов одновременно (для этого нужно использовать потоки).

Потоки (Нитки):

Для обработки нескольких соединений одновременно необходимо использовать многозадачность, то есть каждый входящий запрос обрабатывается в отдельном потоке.

Ограничения:

Сервер не должен ограничивать размер файла.

Не должно быть ограничений на количество одновременно обрабатываемых запросов.

Структура программы:

Основная логика:

Инициализация сервера:

Создать сокет, привязать его к порту, начать прослушивание.

Обработка запросов:

Принять соединение от клиента.

Прочитать HTTP-запрос (например, GET /somefile.txt HTTP/1.1).

Извлечь имя файла из запроса.

Проверить путь и получить файл из директории.

Отправить файл клиенту.

Многозадачность:

Для каждого запроса порождать новый поток, который будет обрабатывать запрос, чтобы не блокировать сервер при ожидании ответа от одного клиента.




потоков нет
• но нужно уметь обслуживать много запросов одновременно
• значит — каждый запрос → отдельный процесс (task)

Это полностью заменяет threads.

*Тогда структура решения:*

основной процесс слушает сокет (listen)

при accept():

вызываете fork()

в дочернем процессе обрабатываете HTTP-запрос и отправляете файл

родитель возвращается к accept()

Это максимально похоже на Apache 1.x.
